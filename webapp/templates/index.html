<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Data UCAO - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card-custom {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        .metric-card {
            transition: transform 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-5px);
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-up { background-color: #28a745; }
        .status-down { background-color: #dc3545; }
        .status-loading { background-color: #ffc107; animation: pulse 1s infinite; }
    </style>
</head>
<body class="gradient-bg">
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card-custom p-4 text-center">
                    <h1 class="display-4 mb-2">
                        <i class="fas fa-chart-line me-3"></i>
                        Big Data Analytics Platform
                    </h1>
                    <p class="lead mb-0">Université Catholique de l'Afrique de l'Ouest - UCAO 2024-2025</p>
                    <small class="text-muted">Projet Master 1 - Traitement Distribué</small>
                </div>
            </div>
        </div>

        <!-- Métriques en temps réel -->
        <div class="row mb-4" id="metrics-row">
            <div class="col-md-3 mb-3">
                <div class="card-custom p-3 metric-card">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-shopping-cart fa-2x text-primary"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h5 class="mb-0" id="total-sales">-</h5>
                            <small class="text-muted">Total Ventes</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-3">
                <div class="card-custom p-3 metric-card">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-dollar-sign fa-2x text-success"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h5 class="mb-0" id="total-revenue">-</h5>
                            <small class="text-muted">Chiffre d'affaires</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-3">
                <div class="card-custom p-3 metric-card">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-clock fa-2x text-info"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h5 class="mb-0" id="realtime-sales">-</h5>
                            <small class="text-muted">Temps réel (24h)</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-3">
                <div class="card-custom p-3 metric-card">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-server fa-2x text-warning"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h5 class="mb-0">
                                <span class="status-indicator status-loading" id="hadoop-status-indicator"></span>
                                <span id="hadoop-status">Vérification...</span>
                            </h5>
                            <small class="text-muted">Statut Hadoop</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Services et accès rapide -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card-custom p-4">
                    <h4 class="mb-3">
                        <i class="fas fa-tachometer-alt me-2"></i>
                        Tableaux de Bord
                    </h4>
                    <div class="d-grid gap-2">
                        <a href="/dashboard/" class="btn btn-primary btn-lg pulse" target="_blank">
                            <i class="fas fa-chart-pie me-2"></i>
                            Dashboard Interactif
                        </a>
                        <small class="text-muted mt-2">
                            Visualisations temps réel, graphiques interactifs et analyses avancées
                        </small>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-3">
                <div class="card-custom p-4">
                    <h4 class="mb-3">
                        <i class="fas fa-cogs me-2"></i>
                        Interfaces d'Administration
                    </h4>
                    <div class="row g-2">
                        <div class="col-6">
                            <a href="http://localhost:9870" class="btn btn-outline-primary btn-sm w-100" target="_blank">
                                <i class="fas fa-database me-1"></i>
                                Hadoop NameNode
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="http://localhost:8088" class="btn btn-outline-success btn-sm w-100" target="_blank">
                                <i class="fas fa-tasks me-1"></i>
                                YARN ResourceManager
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="http://localhost:8080" class="btn btn-outline-warning btn-sm w-100" target="_blank">
                                <i class="fas fa-fire me-1"></i>
                                Spark Master
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="http://localhost:9868" class="btn btn-outline-info btn-sm w-100" target="_blank">
                                <i class="fas fa-copy me-1"></i>
                                Secondary NameNode
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Architecture et statut -->
        <div class="row">
            <div class="col-md-8 mb-3">
                <div class="card-custom p-4">
                    <h4 class="mb-3">
                        <i class="fas fa-sitemap me-2"></i>
                        Architecture du Cluster
                    </h4>
                    <div class="row text-center">
                        <div class="col-md-2 mb-3">
                            <div class="p-3 border rounded">
                                <i class="fas fa-crown fa-2x text-warning mb-2"></i>
                                <h6>Master</h6>
                                <small class="text-muted">NameNode<br>ResourceManager<br>Spark Master</small>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="p-3 border rounded">
                                <i class="fas fa-shield-alt fa-2x text-info mb-2"></i>
                                <h6>Secondary</h6>
                                <small class="text-muted">Secondary<br>NameNode</small>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="p-3 border rounded">
                                <i class="fas fa-server fa-2x text-primary mb-2"></i>
                                <h6>Worker 1</h6>
                                <small class="text-muted">DataNode<br>NodeManager<br>Spark Worker</small>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="p-3 border rounded">
                                <i class="fas fa-server fa-2x text-primary mb-2"></i>
                                <h6>Worker 2</h6>
                                <small class="text-muted">DataNode<br>NodeManager<br>Spark Worker</small>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="p-3 border rounded">
                                <i class="fas fa-server fa-2x text-primary mb-2"></i>
                                <h6>Worker 3</h6>
                                <small class="text-muted">DataNode<br>NodeManager<br>Spark Worker</small>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="p-3 border rounded">
                                <i class="fas fa-leaf fa-2x text-success mb-2"></i>
                                <h6>MongoDB</h6>
                                <small class="text-muted">NoSQL<br>Temps Réel</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-3">
                <div class="card-custom p-4">
                    <h4 class="mb-3">
                        <i class="fas fa-play-circle me-2"></i>
                        Actions Rapides
                    </h4>
                    <div class="d-grid gap-2">
                        <button class="btn btn-success" onclick="runAnalysis('pig')">
                            <i class="fas fa-pig me-2"></i>
                            Lancer Analyses Pig
                        </button>
                        <button class="btn btn-info" onclick="runAnalysis('mongodb')">
                            <i class="fas fa-database me-2"></i>
                            Analyse MongoDB-Spark
                        </button>
                        <button class="btn btn-warning" onclick="runAnalysis('spark')">
                            <i class="fas fa-fire me-2"></i>
                            Tests Spark Complets
                        </button>
                    </div>
                    
                    <hr class="my-3">
                    
                    <h5 class="mb-2">
                        <i class="fas fa-info-circle me-2"></i>
                        Informations
                    </h5>
                    <small class="text-muted">
                        <strong>Dernière mise à jour:</strong><br>
                        <span id="last-update">-</span>
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Mise à jour des métriques
        function updateMetrics() {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('total-sales').textContent = data.total_sales || '-';
                    document.getElementById('total-revenue').textContent = data.total_revenue ? '$' + data.total_revenue.toFixed(2) : '-';
                    document.getElementById('realtime-sales').textContent = data.realtime_sales || '-';
                    document.getElementById('last-update').textContent = new Date(data.timestamp).toLocaleString();
                })
                .catch(error => {
                    console.error('Erreur lors de la récupération des métriques:', error);
                });
        }

        // Mise à jour du statut Hadoop
        function updateHadoopStatus() {
            fetch('/api/hadoop_status')
                .then(response => response.json())
                .then(data => {
                    const indicator = document.getElementById('hadoop-status-indicator');
                    const status = document.getElementById('hadoop-status');
                    
                    if (data.namenode === 'UP' && data.resourcemanager === 'UP') {
                        indicator.className = 'status-indicator status-up';
                        status.textContent = 'Opérationnel';
                    } else {
                        indicator.className = 'status-indicator status-down';
                        status.textContent = 'Hors ligne';
                    }
                })
                .catch(error => {
                    console.error('Erreur lors de la vérification Hadoop:', error);
                    document.getElementById('hadoop-status-indicator').className = 'status-indicator status-down';
                    document.getElementById('hadoop-status').textContent = 'Erreur';
                });
        }

        // Fonction pour lancer les analyses
        function runAnalysis(type) {
            const messages = {
                'pig': 'Analyse Pig lancée. Consultez les logs Docker pour suivre le progrès.',
                'mongodb': 'Analyse MongoDB-Spark lancée. Consultez les logs Docker pour suivre le progrès.',
                'spark': 'Tests Spark lancés. Consultez les logs Docker pour suivre le progrès.'
            };
            
            alert(messages[type]);
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateMetrics();
            updateHadoopStatus();
            
            // Mise à jour périodique
            setInterval(updateMetrics, 5000);
            setInterval(updateHadoopStatus, 10000);
        });
    </script>
</body>
</html>